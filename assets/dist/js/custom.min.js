function getTotalDistanceString(t){var a="";null!=t&&(a="Total Distance = "+(t/1e3).toFixed(3)+" KM");return a}function getHourMinuteString(t){var a=t/6e4;return Math.floor(a/60)+" hr "+(a%60).toFixed(0)+"min"}function getTotalDistanceFromLatLngArray(t,a){var i,r,l,s,d=0,c=0;return null==t||null==t?1==a?"":d:t.length<2?1==a?"":d:(t.forEach(function(t){0==c&&(i=t.latitude,r=t.longitude),l=t.latitude,s=t.longitude;var a=(l-i)*Math.PI/180,e=(s-r)*Math.PI/180,o=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),n=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));d+=6371*n,i=l,r=s,c++}),a?"Total Distance = "+d.toFixed(3)+" KM":d)}$(function(){$(".mapgenerate").click(function(){currentElem=$(this),currentElem.find(".fa-map-marker").hide(),currentElem.find(".fa-spinner").show(),currentElem.attr("disabled",!0);var t=$(this).data("date"),a=$(this).data("eid"),l=($(this).data("rowid"),"Location Map:"+$(this).data("ename")+" "+t);gpsType=$(this).data("gps_type"),$.ajax({type:"GET",dataType:"json",url:ajaxUrls.getFileLocation,data:{eid:a,mapdate:t,gpsType:gpsType},success:function(t){locations=[];var e,a=JSON.parse(t.fileloc),o=JSON.parse(JSON.stringify(t.partyLoc));currentElem.find(".fa-map-marker").show(),currentElem.find(".fa-spinner").hide(),currentElem.attr("disabled",!1),arrayGroupdedLocations=[],arrayPaths=[],totalDistance=0,totalFineDistance=0;var n=new google.maps.InfoWindow;if($.each(a,function(t,a){arrayGroupdedLocations.push(a),a.forEach(function(t){e=new google.maps.LatLng(t.latitude,t.longitude)})}),"path"==gpsType||"py_processed_path"==gpsType){var i=new google.maps.Map(document.getElementById("devmap"),{mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!0,zoom:16,center:e});lineSymbol={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW},arrayGroupdedLocations.forEach(function(t){var o=[];t.forEach(function(a){var e;r=new google.maps.Marker({position:new google.maps.LatLng(a.latitude,a.longitude),icon:lineSymbol,map:i,title:"",label:""}),google.maps.event.addListener(r,"mouseover",(e=r,function(){var t="DateTime :"+a.datetime;a.latitude,a.longitude,n.setContent(t),n.open(i,e)})),o.push(r.getPosition()),new google.maps.Polyline({icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW},offset:"100%"}],map:i,path:o,strokeColor:"red",strokeOpacity:5,strokeWeight:2})}),totalFineDistance+=getTotalDistanceFromLatLngArray(t,!1)})}else{var r;i=new google.maps.Map(document.getElementById("devmap"),{zoom:15,center:e,mapTypeId:google.maps.MapTypeId.TERRAIN});arrayGroupdedLocations.forEach(function(t){t.forEach(function(t){r=new google.maps.Marker({position:new google.maps.LatLng(t.latitude,t.longitude),map:i,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:"#3c763d",fillOpacity:.6,strokeColor:"#3c763d",strokeOpacity:.9,strokeWeight:1,scale:5}})}),totalFineDistance+=getTotalDistanceFromLatLngArray(t,!1)})}$.each(o,function(t,a){var e;r=new google.maps.Marker({position:new google.maps.LatLng(a.latitude,a.longitude),icon:{url:"/assets/dist/img/markers/Official_8.png",scaledSize:new google.maps.Size(32,32)},title:a.company_name,map:i}),google.maps.event.addListener(r,"click",(e=r,function(){n.setContent(a.company_name),n.open(i,e)}))}),$("#total-distance").html("Total Distance = "+totalFineDistance.toFixed(3)+"KM"),$("#modal-default").find(".modal-title").text(l),$("#modal-default").modal("show")},error:function(t){currentElem.find(".fa-map-marker").show(),currentElem.find(".fa-spinner").hide(),currentElem.attr("disabled",!1)}})}),$(".hourdetail2").click(function(){var t=$(this).data("mdate"),a=$(this).data("mid"),o=$(this).data("row_date"),n=$(this).data("employee_name");$.ajax({type:"GET",dataType:"json",url:ajaxUrls.getWorkedHourDetails,data:{eid:a,mapdate:t},success:function(t){var i=0,r=0,l="";t.reverse(),$.each(t,function(t,a){var e=getTotalDistanceFromLatLngArray(a.locations,!1),o=a.checkout-a.checkin,n=0==o?"<td><span class='label label-danger'> N/A </td>":"<td>"+a.cout_time+"</td>";l=l+"<tr> <td>"+a.cin_time+"</td>"+n+"<td>"+e.toFixed(3)+"&nbsp;KM</td> </tr>",i+=e,r+=o});var a="Total Worked Hour: "+getHourMinuteString(r),e="Total Distance Travelled: "+i.toFixed(3)+" KM";$("#emp_name_date").html(n+"("+o+")"),$("#total_hr_string").html(a),$("#total_distance_string").html(e),$("#cicolist").html(l),$("#workhours").modal("show")}})})});